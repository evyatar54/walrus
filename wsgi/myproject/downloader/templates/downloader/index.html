{% load staticfiles %}
<head>
<title>Mass Searcher</title>
<link rel="stylesheet" type="text/css" href="{% static 'downloader/style.css' %}" />
<link rel="shortcut icon" href="{% static 'downloader/favicon.ico' %}" />

<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>

<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

<script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.4.4/angular.min.js"></script>
</head>

{% verbatim %}
<div class="body" ng-app="myApp" ng-controller="queryCtrl">

	<div class="jumbotron well row site_header">
		<div class="col-md-6">
			<h1> Mass Searcher </h1>
		</div>
		<div class="col-md-6">
			<br><br><br><p> search multiple queries simultaneously over multiple search engines </p>
		</div>
	</div>
	<br>
	<div class="container main_app">

		<div class="raw query_area">
			
			<form novalidate>
				<div class="col-md-12 raw well">
					<div class="col-md-11"> 
						<input class="input" placeholder="Enter Query" type="text" ng-model="query"/> 
					</div>
					<div class="col-md-1"> 	
						<button class="btn btn-info my_button" ng-click="ok()"> OK </button>
					</div>
				</div>
			</form>
			
			<div class="table_area">
				<table class="table table-striped table-hover" id="quries_table">
					<tr class="tr" ng-repeat="x in queries track by $index">
						<td class="td">{{x}} <button class="btn btn-info pull-right my_button" ng-click="remove($index)"> Remove </button> </td>
					</tr>
				</table>
			</div>
		</div>
		
	</div>

	<br>

	<div class="container buttom_toolbar">
		<br>
		<button class="btn btn-info pull-right" ng-click="go(queries)">submit</button>
	</div>
	
	<br>
	<div class="result_area" style="width:70%;">
		<table class="table table-striped table-hover" ng-repeat="r in results" id="result_table">
			<thead>
				<tr>
					<th>Name</th>
					<th>Size</th>
					<th>Seeds</th>
					<th>Age</th>
					<th>Link</th>
				</tr>
			</thead>
			<tbody>
				<tr class="tr" ng-repeat="line in r">
					<td class="td" ng-repeat="col in line ">{{col}} </td>
				</tr>
			</tbody>
		</table>
	</div>
</div>
{% endverbatim  %}

<script>
var app = angular.module('myApp', []);
app.controller('queryCtrl', function($scope) {
	$scope.queries = new Array();
	$scope.results = new Array();
	$scope.wow = ""
    $scope.ok = function() 
	{
		if(!$scope.query)
			alert("Query must be non empty.\ngot: " + $scope.query);
		else
		{
			$scope.queries.push(angular.copy($scope.query));
			$scope.query = "";
		}
    };
	
	$scope.remove = function(index)
	{
		$scope.queries.splice(index,1);
	};
	
	$scope.submit = function()
	{
		$scope.submited_queries = $scope.queries;
		$scope.queries = new Array();
	};
	
	$scope.go = function(Qs)
	{	
		var _url = "{% url 'search' %}";
		data = {"csrfmiddlewaretoken": "{{ csrf_token }}", state:"inactive", "Qs": Qs};
		$.post(_url, data, function(response)
		{
			alert(response);
			if(response)
			{
				alert(JSON.stringify(response));
				$scope.$apply(function() { 
					$scope.results = response;
				});
			}
			else
			{
				alert("empty");
			}
		});
	}
});


</script>

